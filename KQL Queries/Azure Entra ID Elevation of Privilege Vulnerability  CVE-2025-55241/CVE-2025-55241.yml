title: Actor Token Abuse in Entra ID (CVE-2025-55241) â€” No Nearby Interactive Sign-In (Correlation)
id: 8xxxxxxe-4xxx-4xxx-9xxx-6xxxxxxxxxxx
type: correlation
status: stable
description: >
  High-fidelity correlation: find actor-token style audit events and suppress them
  if an interactive sign-in by the same UPN occurred within the last 10 minutes.
  Encodes the absence-of-signin logic from the production KQL.
author: lohit 
date: 2025/09/27
references:
  - https://dirkjanm.io/obtaining-global-admin-in-every-entra-id-tenant-with-actor-tokens/
tags:
  - cve.2025-55241
  - attack.t1078.004
  - attack.t1098
  - cloud.iam
# Rule A (Audit): mirrors CloudAppEvents portion
rule_a:
  logsource:
    product: azure
    service: auditlogs
    category: iam
  detection:
    selection_app:
      Application|contains:
        - Microsoft Entra ID
        - Azure Active Directory

    selection_actor_mismatch:
      InitiatedBy.user.displayName|in:
        - Office 365 Exchange Online
        - Office 365 SharePoint Online
        - Skype for Business Online
        - Dataverse
        - Microsoft Dynamics ERP

    selection_ops:
      OperationName|in:
        - Add member to role
        - Add service principal credentials
        - Add app role assignment to service principal
        - Add delegated permission grant
        - Add owner to service principal
        - Add password credential
        - Consent to application
        - Update application
        - Update user
        - Add service principal
        - Update conditional access policy

    filter_group_noise:
      OperationName|contains: group

    filter_dir_feature:
      OperationName: Set directory feature on tenant

    filter_known_good_upns:
      InitiatedBy.user.userPrincipalName|in:
        - ''   # populate with trusted automation/service UPNs

    condition: selection_app and selection_actor_mismatch and selection_ops
               and not filter_group_noise and not filter_dir_feature
               and not filter_known_good_upns
  group-by:
    - InitiatedBy.user.userPrincipalName
  timeframe: 14d

# Rule B (Signin): mirrors IdentityLogonEvents portion
rule_b:
  logsource:
    product: azure
    service: signinlogs        # Entra ID Sign-in Logs (maps to IdentityLogonEvents in M365 Defender)
  detection:
    signin_present:
      AccountUpn|exists: true
    condition: signin_present
  group-by:
    - AccountUpn
  timeframe: 10m

# Correlation expression:
# Fire when Rule A matches and there is NO Rule B hit for the same UPN within 10 minutes.
expression: rule_a by InitiatedBy.user.userPrincipalName and not rule_b within 10m by AccountUpn

level: critical
falsepositives:
  - Very low. Potentially Microsoft/first-party maintenance actions; verify source IP and change ticket.
fields:
  - Timestamp
  - Application
  - OperationName
  - InitiatedBy.user.userPrincipalName
  - InitiatedBy.user.displayName
  - InitiatedBy.app.displayName
  - AccountUpn
  - IPAddress
  - UserAgent
notes: >
  If your Sigma backend does not support correlation rules, deploy the single-event rule above.
  For best fidelity, maintain a small allowlist (known-good UPNs) and review all hits.
