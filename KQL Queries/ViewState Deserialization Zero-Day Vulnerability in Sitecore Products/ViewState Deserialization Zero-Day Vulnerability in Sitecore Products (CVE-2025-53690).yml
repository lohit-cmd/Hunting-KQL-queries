---
title: ASP.NET ViewState/Deserialization + IIS/SharePoint Code Execution (w3wp chain)
id: 00000002-000f-000d-000e-000000000007
status: stable
description: >
  Correlates w3wp (IIS/ASP.NET) spawning shells/LOLBINs with
  subsequent web-root writes and/or external egress within 10 minutesâ€”TTP-only
  (no IOCs). Aligns with KQL that detects ViewState/deserialization-driven code
  execution on IIS/SharePoint.
author: lohit
date: 2025/09/11
references:
  - https://cloud.google.com/blog/topics/threat-intelligence/viewstate-deserialization-zero-day-vulnerability/
tags:
  - attack.T1190
  - attack.T1059
  - attack.T1105
  - attack.T1505.003
level: high
type: correlation
correlation:
  type: sequence
  timeframe: 10m
  by:
    - host
logsource:
  product: windows
  category: process_creation
detection:
  sel_a_parent:
    ParentImage|endswith:
      - \w3wp.exe
      - \aspnet_wp.exe
      - \iisexpress.exe
  sel_a_child_image:
    Image|endswith:
      - \cmd.exe
      - \powershell.exe
      - \pwsh.exe
      - \cscript.exe
      - \wscript.exe
      - \mshta.exe
      - \rundll32.exe
      - \regsvr32.exe
      - \msbuild.exe
      - \installutil.exe
      - \csc.exe
      - \certutil.exe
      - \bitsadmin.exe
      - \curl.exe
      - \schtasks.exe
      - \wmic.exe
      - \msiexec.exe
  sel_a_child_cmd:
    CommandLine|contains:
      - " -enc"
      - -encodedcommand
      - FromBase64String
      - " IEX "
      - DownloadString
      - Reflection.Assembly
      - ::Load
      - " /c "
      - " -nop"
      - " -w hidden"
      - " -Command "
      - http://
      - https://
      - -urlcache
  filter_a_allow_compilers:
    Image|endswith:
      - \csc.exe
      - \vbc.exe
      - \aspnet_compiler.exe
      - \ngen.exe
  filter_a_allow_admin:
    Image|endswith:
      - \appcmd.exe
      - \iisreset.exe
  filter_a_allow_flags_absent:
    CommandLine|contains:
      - ""
  step_a:
    condition: sel_a_parent and (sel_a_child_image or sel_a_child_cmd) and not (
      (filter_a_allow_compilers or filter_a_allow_admin) and not sel_a_child_cmd
      )
logsource_2:
  product: windows
  category: file_event
detection_2:
  sel_b_parent:
    Image|endswith:
      - \w3wp.exe
      - \aspnet_wp.exe
      - \iisexpress.exe
  sel_b_paths:
    TargetFilename|contains:
      - \inetpub\wwwroot\
      - \www\
      - \vhosts\
      - \Web Server Extensions\15\TEMPLATE\LAYOUTS\
      - \Web Server Extensions\16\TEMPLATE\LAYOUTS\
  filter_b_asptemp:
    TargetFilename|contains:
      - \Windows\Microsoft.NET\Framework\
      - \Windows\Microsoft.NET\Framework64\
      - \Temporary ASP.NET Files\
  sel_b_ext:
    TargetFilename|endswith:
      - .aspx
      - .ashx
      - .asmx
      - .config
      - .dll
      - .cs
  step_b:
    condition: sel_b_parent and sel_b_paths and sel_b_ext and not filter_b_asptemp
logsource_3:
  product: windows
  category: network_connection
detection_3:
  sel_c_proc:
    Image|endswith:
      - \w3wp.exe
      - \cmd.exe
      - \powershell.exe
      - \pwsh.exe
  sel_c_ports:
    DestinationPort:
      - 80
      - 443
      - 8080
      - 8443
  filter_c_okhosts:
    DestinationHostname|endswith:
      - microsoftonline.com
      - visualstudio.microsoft.com
      - packages.microsoft.com
  filter_c_private:
    DestinationIp|is_private_ip: true
  step_c:
    condition: sel_c_proc and sel_c_ports and not filter_c_private and not
      filter_c_okhosts
detection_corr:
  seq1:
    - ref: step_a
    - or:
        - ref: step_b
        - ref: step_c
  seq2:
    - ref: step_b
    - ref: step_c
  condition: seq1 or seq2
